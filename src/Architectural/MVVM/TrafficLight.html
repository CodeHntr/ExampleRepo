<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="style.css" type="text/css"/>
    <title>StreetLight</title>
    <script
            src="https://code.jquery.com/jquery-3.6.0.min.js"
            integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
            crossorigin="anonymous">
    </script>
</head>

<body>

<script>
    $(document).ready(function() {

        $.ajax({
            method: "GET",
            url: "routing.php",
            data: {type: 'getStreetLights'},

            success: function (response) {
                let streetLights = JSON.parse(response);
                let rows = '';
                streetLights.forEach((streetLight) => {
                    console.dir(streetLight);
                    rows += "<tr><td>" + streetLight.id + "</td><td>" + streetLight.address + ' ' + "</td><td>" + streetLight.state + "</td></tr>";

                });

                console.dir(rows);
                $('.tbTrafficLights ').append(rows);
            },

            error: function (response) {
                console.error(response);
            }
        });

        $('button.send').on('click', function() {

            $.ajax({
                method: "POST",
                url: "routing.php",
                data: {
                    address: $('input.address').val(),
                    state: $('input.state').val(),
                    type: 'create'
                }
            })
                .done(function( response ) {
                    let streetLight = JSON.parse(response);
                    let rows =
                        "<tr><td>" + streetLight.id
                        + "</td><td>"
                        + streetLight.address
                        + ' '
                        + "</td><td>"
                        + streetLight.state
                        + "</td></tr>";
                    $('.tbTrafficLights ').append(rows);
                });

            $('input.address').val('');
            $('input.state').val('');

        });

        $('button.deletor').on('click', function() {

            console.log('Data deleted');
            $.ajax({
                method: "POST",
                url: "routing.php",
                data: {
                    type: 'deleteAll'
                }
            })

        });

        $('button.deleteById').on('click', function() {

            console.log('TrafficLight deleted');
            $.ajax({
                method: "POST",
                url: "routing.php",
                data: {
                    id: $('input.id').val(),
                    type: 'deleteById'
                },
                success: function() {location.reload();}
            })
            $('input.id').val('');
        });

    });

</script>


<h1>
    Додати світлофор
</h1>

<input type="text" name="address" class="address" placeholder="Адреса світлофора"> <br>
<input type="text" name="state" class="state" placeholder="Стан"> <br>
<button class="send">Додати Світлофор</button>

<hr>
<div id="trafficLightsTable">
    <h2>Робочі світлофори</h2>
    <table class="tbTrafficLights" border="2" align="">
        <tr>
            <th>ID</th>
            <th>Address</th>
            <th>State</th>
        </tr>
    </table>
    <button class="deletor">Видалити всі світлофори</button>
</div>

<hr>

<h2>Переключити світлофор</h2>
<input type="text" name="changeState" class="changeState" placeholder="Вкажіть стан світлофора"> <br>
<input type="text" name="changeById" class="changeById" placeholder="Вкажіть його Id">
<button class ="changeId">Переключити світлофор</button>


<hr>

<h2>Видалити світлофор по id</h2>
<input type="text" name="id" class="id" placeholder="Вкажіть id світлофора">
<button class ="deleteById">Видалити</button>

<hr>

<h2>Показати світлофор</h2>
<input type="text" name="byId" class="byId" placeholder="Вкажіть id світлофора">
<button class ="showById">Показати світлофор</button>

</body>
</html>

